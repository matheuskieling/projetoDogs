{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/mathe/Documents/backu\\u1E55/programming/origamid/react/projetoFinalDogs/dogs/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/mathe/Documents/backu\\u1E55/programming/origamid/react/projetoFinalDogs/dogs/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/mathe/Documents/backu\\u1E55/programming/origamid/react/projetoFinalDogs/dogs/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{Navigate,useNavigate}from'react-router-dom';import{TOKEN_POST,TOKEN_VALIDATE_POST,USER_GET}from'./api';import{jsx as _jsx}from\"react/jsx-runtime\";export var UserContext=/*#__PURE__*/React.createContext();export var UserStorage=function UserStorage(_ref){var children=_ref.children;var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),data=_React$useState2[0],setData=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),login=_React$useState4[0],setLogin=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),loading=_React$useState6[0],setLoading=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),error=_React$useState8[0],setError=_React$useState8[1];var navigate=useNavigate();var userLogout=React.useCallback(/*#__PURE__*/function(){var _userLogout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setData(null);setError(null);setLoading(false);setLogin(false);window.localStorage.removeItem('token');navigate('/login');case 6:case\"end\":return _context.stop();}},_callee);}));function userLogout(){return _userLogout.apply(this,arguments);}return userLogout;}(),[navigate]);function getUser(_x){return _getUser.apply(this,arguments);}function _getUser(){_getUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(token){var _USER_GET,url,options,response,json;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_USER_GET=USER_GET(token),url=_USER_GET.url,options=_USER_GET.options;_context3.next=3;return fetch(url,options);case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:json=_context3.sent;setData(json);setLogin(true);case 9:case\"end\":return _context3.stop();}},_callee3);}));return _getUser.apply(this,arguments);}function userLogin(_x2,_x3){return _userLogin.apply(this,arguments);}function _userLogin(){_userLogin=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(username,password){var _TOKEN_POST,url,options,tokenRes,_yield$tokenRes$json,token;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.prev=0;setError(null);setLoading(true);_TOKEN_POST=TOKEN_POST({username:username,password:password}),url=_TOKEN_POST.url,options=_TOKEN_POST.options;_context4.next=6;return fetch(url,options);case 6:tokenRes=_context4.sent;if(tokenRes.ok){_context4.next=9;break;}throw new Error(\"Erro: Usu\\xE1rio Inv\\xE1lido\");case 9:_context4.next=11;return tokenRes.json();case 11:_yield$tokenRes$json=_context4.sent;token=_yield$tokenRes$json.token;window.localStorage.setItem('token',token);_context4.next=16;return getUser(token);case 16:navigate('/conta');_context4.next=24;break;case 19:_context4.prev=19;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);setError(_context4.t0.message);setLogin(false);case 24:_context4.prev=24;setLoading(false);return _context4.finish(24);case 27:case\"end\":return _context4.stop();}},_callee4,null,[[0,19,24,27]]);}));return _userLogin.apply(this,arguments);}React.useEffect(function(){function autoLogin(){return _autoLogin.apply(this,arguments);}function _autoLogin(){_autoLogin=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var token,_TOKEN_VALIDATE_POST,url,options,response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:token=window.localStorage.getItem('token');if(!token){_context2.next=23;break;}_context2.prev=2;setError(null);setLoading(true);_TOKEN_VALIDATE_POST=TOKEN_VALIDATE_POST(token),url=_TOKEN_VALIDATE_POST.url,options=_TOKEN_VALIDATE_POST.options;_context2.next=8;return fetch(url,options);case 8:response=_context2.sent;if(response.ok){_context2.next=11;break;}throw new Error('Token Inválido');case 11:_context2.next=13;return getUser(token);case 13:_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](2);userLogout();case 18:_context2.prev=18;setLoading(false);return _context2.finish(18);case 21:_context2.next=24;break;case 23:setLogin(false);case 24:case\"end\":return _context2.stop();}},_callee2,null,[[2,15,18,21]]);}));return _autoLogin.apply(this,arguments);}autoLogin();},[userLogout]);return/*#__PURE__*/_jsx(UserContext.Provider,{value:{userLogin:userLogin,userLogout:userLogout,data:data,error:error,loading:loading,login:login},children:children});};","map":{"version":3,"names":["React","Navigate","useNavigate","TOKEN_POST","TOKEN_VALIDATE_POST","USER_GET","UserContext","createContext","UserStorage","children","useState","data","setData","login","setLogin","loading","setLoading","error","setError","navigate","userLogout","useCallback","window","localStorage","removeItem","getUser","token","url","options","fetch","response","json","userLogin","username","password","tokenRes","ok","Error","setItem","console","log","message","useEffect","autoLogin","getItem"],"sources":["C:/Users/mathe/Documents/backuṕ/programming/origamid/react/projetoFinalDogs/dogs/src/UserContext.js"],"sourcesContent":["import React from 'react';\r\nimport { Navigate, useNavigate } from 'react-router-dom';\r\nimport { TOKEN_POST, TOKEN_VALIDATE_POST, USER_GET } from './api';\r\n\r\nexport const UserContext = React.createContext();\r\n\r\nexport const UserStorage = ({ children }) => {\r\n  const [data, setData] = React.useState(null);\r\n  const [login, setLogin] = React.useState(null);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const userLogout = React.useCallback(\r\n    async function userLogout() {\r\n      setData(null);\r\n      setError(null);\r\n      setLoading(false);\r\n      setLogin(false);\r\n      window.localStorage.removeItem('token');\r\n      navigate('/login');\r\n    },\r\n    [navigate],\r\n  );\r\n\r\n  async function getUser(token) {\r\n    const { url, options } = USER_GET(token);\r\n    const response = await fetch(url, options);\r\n    const json = await response.json();\r\n    setData(json);\r\n    setLogin(true);\r\n  }\r\n\r\n  async function userLogin(username, password) {\r\n    try {\r\n      setError(null);\r\n      setLoading(true);\r\n      const { url, options } = TOKEN_POST({ username, password });\r\n      const tokenRes = await fetch(url, options);\r\n      if (!tokenRes.ok) throw new Error(`Erro: Usuário Inválido`);\r\n      const { token } = await tokenRes.json();\r\n      window.localStorage.setItem('token', token);\r\n      await getUser(token);\r\n      navigate('/conta');\r\n    } catch (err) {\r\n      console.log(err);\r\n      setError(err.message);\r\n      setLogin(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    async function autoLogin() {\r\n      const token = window.localStorage.getItem('token');\r\n      if (token) {\r\n        try {\r\n          setError(null);\r\n          setLoading(true);\r\n          const { url, options } = TOKEN_VALIDATE_POST(token);\r\n          const response = await fetch(url, options);\r\n          if (!response.ok) throw new Error('Token Inválido');\r\n          await getUser(token);\r\n        } catch (err) {\r\n          userLogout();\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      } else {\r\n        setLogin(false);\r\n      }\r\n    }\r\n    autoLogin();\r\n  }, [userLogout]);\r\n\r\n  return (\r\n    <UserContext.Provider\r\n      value={{ userLogin, userLogout, data, error, loading, login }}\r\n    >\r\n      {children}\r\n    </UserContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}